<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PURE Hexagonal Grid</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Cormorant+Garamond:wght@600;700&display=swap');

  :root {
    --bg: #0a0e17;
    --bg-raised: #0e1320;
    --border: #1a2234;
    --border-hover: #2a3a54;
    --text-dim: #3a4a5e;
    --text-mid: #5a6a7e;
    --text: #8a9ab0;
    --text-bright: #c8d4e2;
    --text-white: #eef2f7;
    --origin: #cc7000;
    --origin-stroke: #e8a020;
    --origin-text: #fff4e0;
    --tri: #0a7a6a;
    --tri-stroke: #12d4a8;
    --tri-text: #7effd4;
    --cell: #141c2a;
    --cell-stroke: #1e2a3d;
    --cell-text: #4a5a6e;
    --hover-fill: #1e2840;
    --hover-stroke: #6a8ab0;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Mono', monospace;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    user-select: none;
  }

  .header {
    padding: 14px 20px 10px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-raised);
    display: flex;
    align-items: baseline;
    gap: 14px;
    flex-shrink: 0;
  }

  .header h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 22px;
    font-weight: 700;
    color: var(--text-white);
    letter-spacing: 0.5px;
  }

  .header .tag {
    font-size: 9px;
    color: var(--text-dim);
    letter-spacing: 2.5px;
    text-transform: uppercase;
  }

  .toolbar {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-raised);
    flex-shrink: 0;
    flex-wrap: wrap;
  }

  .tb-group {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .tb-label {
    font-size: 9px;
    color: var(--text-dim);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-right: 2px;
  }

  .tb-sep {
    width: 1px;
    height: 18px;
    background: var(--border);
    margin: 0 6px;
  }

  .btn {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    font-weight: 500;
    padding: 3px 9px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-mid);
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .btn:hover {
    border-color: var(--border-hover);
    color: var(--text);
  }

  .btn.on {
    background: rgba(18, 212, 168, 0.08);
    border-color: rgba(18, 212, 168, 0.3);
    color: var(--tri-stroke);
  }

  .btn.on-origin {
    background: rgba(204, 112, 0, 0.08);
    border-color: rgba(204, 112, 0, 0.3);
    color: var(--origin-stroke);
  }

  input[type="range"] {
    width: 70px;
    accent-color: var(--tri-stroke);
    cursor: pointer;
  }

  .ring-val {
    font-size: 11px;
    color: var(--text-bright);
    font-weight: 600;
    min-width: 16px;
    text-align: center;
  }

  .canvas-area {
    flex: 1;
    position: relative;
    overflow: hidden;
    cursor: grab;
  }

  .canvas-area:active { cursor: grabbing; }

  canvas { position: absolute; top: 0; left: 0; }

  .info {
    position: absolute;
    bottom: 14px;
    left: 14px;
    background: rgba(10, 14, 23, 0.94);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 10px 14px;
    font-size: 10.5px;
    line-height: 1.8;
    min-width: 200px;
    pointer-events: none;
    z-index: 5;
  }

  .info .il { color: var(--text-dim); }
  .info .iv { color: var(--text-bright); font-weight: 600; }
  .info .it { color: var(--tri-stroke); font-weight: 600; }

  .zoom-label {
    position: absolute;
    top: 8px;
    right: 14px;
    font-size: 9px;
    color: var(--text-dim);
    pointer-events: none;
    z-index: 5;
  }
</style>
</head>
<body>

<div class="header">
  <h1>PURE Hexagonal Grid</h1>
  <span class="tag">Interactive Explorer</span>
</div>

<div class="toolbar">
  <div class="tb-group">
    <span class="tb-label">Rings</span>
    <input type="range" id="rSlider" min="1" max="10" value="10" oninput="setRings(+this.value)">
    <span class="ring-val" id="rVal">10</span>
  </div>
  <div class="tb-sep"></div>
  <div class="tb-group">
    <span class="tb-label">Show</span>
    <button class="btn on" id="bSpiral" onclick="setLabel('spiral')">Spiral #</button>
    <button class="btn" id="bRingPos" onclick="setLabel('ringpos')">Ring.Pos</button>
    <button class="btn" id="bAxial" onclick="setLabel('axial')">Axial (q,r)</button>
    <button class="btn" id="bCube" onclick="setLabel('cube')">Cube (q,r,s)</button>
  </div>
  <div class="tb-sep"></div>
  <div class="tb-group">
    <span class="tb-label">Highlight</span>
    <button class="btn" id="bTri" onclick="toggle('tri')">▲ Triangles</button>
    <button class="btn" id="bRingC" onclick="toggle('ringColor')">Ring Colors</button>
  </div>
</div>

<div class="canvas-area" id="area">
  <canvas id="cv"></canvas>
  <div class="info" id="info"><span class="il">Hover a cell to inspect</span></div>
  <div class="zoom-label" id="zl">Scroll to zoom · Drag to pan</div>
</div>

<script>
// ─── Spiral generation: CW from E, pointy-top ───
const CW_WALK = [[-1,1],[-1,0],[0,-1],[1,-1],[1,0],[0,1]];

function genSpiral(maxRing) {
  const cells = [{num:1, q:0, r:0, ring:1, pos:0}];
  let num = 2, wq = 0, wr = 0;
  for (let ring = 2; ring <= maxRing; ring++) {
    const sl = ring - 1;
    wq += 1; // step E
    let q = wq, r = wr, posInRing = 0;
    for (let side = 0; side < 6; side++) {
      const [dq, dr] = CW_WALK[side];
      for (let step = 0; step < sl; step++) {
        cells.push({num: num++, q, r, ring, pos: posInRing++});
        q += dq; r += dr;
      }
    }
  }
  return cells;
}

const allCells = genSpiral(10);

// Triangular numbers
const triSet = new Set();
for (let n = 1; n*(n+1)/2 <= 600; n++) triSet.add(n*(n+1)/2);

// Ring colors
const RING_COLS = [
  '#cc7000','#2288bb','#2a99aa','#33aa77','#55bb55',
  '#77aa44','#99aa33','#bbaa22','#cc8833','#dd6644'
];

// ─── State ───
let maxRing = 10, labelMode = 'spiral';
let showTri = false, showRingColor = false;
let panX = 0, panY = 0, zoom = 1, hovered = null;

// ─── Canvas ───
const cv = document.getElementById('cv');
const ctx = cv.getContext('2d');
const area = document.getElementById('area');
const HEX = 22;
const S3 = Math.sqrt(3);

function toPixel(q, r) {
  return [HEX * (S3 * q + S3/2 * r), HEX * (1.5 * r)];
}

function hexPath(cx, cy, sz) {
  ctx.beginPath();
  for (let i = 0; i < 6; i++) {
    const a = Math.PI/180 * (60*i - 30);
    const hx = cx + sz * Math.cos(a);
    const hy = cy + sz * Math.sin(a);
    i === 0 ? ctx.moveTo(hx, hy) : ctx.lineTo(hx, hy);
  }
  ctx.closePath();
}

function render() {
  const W = area.clientWidth, H = area.clientHeight;
  const dpr = devicePixelRatio;
  cv.width = W * dpr; cv.height = H * dpr;
  cv.style.width = W + 'px'; cv.style.height = H + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

  ctx.fillStyle = '#080c14';
  ctx.fillRect(0, 0, W, H);

  ctx.save();
  ctx.translate(W/2 + panX, H/2 + panY);
  ctx.scale(zoom, zoom);

  const vis = allCells.filter(c => c.ring <= maxRing);
  const sz = HEX * 0.92;

  for (const c of vis) {
    const [px, py] = toPixel(c.q, c.r);
    const isO = c.num === 1;
    const isT = triSet.has(c.num) && !isO;
    const isH = hovered && hovered.num === c.num;

    let fill, stroke, tc, sw;

    if (isH) {
      fill = '#1e2840'; stroke = '#6a8ab0'; tc = '#ffffff'; sw = 1.5;
    } else if (isO) {
      fill = '#cc7000'; stroke = '#e8a020'; tc = '#fff4e0'; sw = 2;
    } else if (showTri && isT) {
      fill = '#0a6a5a'; stroke = '#12d4a8'; tc = '#7effd4'; sw = 1.8;
    } else if (showRingColor) {
      const rc = RING_COLS[c.ring - 1] || '#555';
      const r = parseInt(rc.slice(1,3),16), g = parseInt(rc.slice(3,5),16), b = parseInt(rc.slice(5,7),16);
      fill = `rgba(${r},${g},${b},0.35)`; stroke = rc; tc = '#ddd'; sw = 0.8;
    } else {
      fill = '#141c2a'; stroke = '#1e2a3d'; tc = '#4a5a6e'; sw = 0.7;
    }

    hexPath(px, py, sz);
    ctx.fillStyle = fill; ctx.fill();
    ctx.strokeStyle = stroke; ctx.lineWidth = sw; ctx.stroke();

    // Label
    let label;
    const s = -c.q - c.r;
    switch(labelMode) {
      case 'spiral': label = ''+c.num; break;
      case 'ringpos': label = c.ring+'.'+c.pos; break;
      case 'axial': label = c.q+','+c.r; break;
      case 'cube': label = c.q+','+c.r+','+s; break;
    }

    let fs;
    if (labelMode === 'spiral') fs = c.num < 10 ? 10 : c.num < 100 ? 8 : 6.5;
    else if (labelMode === 'cube') fs = 5.5;
    else fs = 7;

    ctx.fillStyle = tc;
    ctx.font = `500 ${fs}px 'IBM Plex Mono'`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(label, px, py + 0.5);
  }

  ctx.restore();
}

// ─── Controls ───
function setRings(n) {
  maxRing = n;
  document.getElementById('rVal').textContent = n;
  render();
}

function setLabel(mode) {
  labelMode = mode;
  document.getElementById('bSpiral').classList.toggle('on', mode==='spiral');
  document.getElementById('bRingPos').classList.toggle('on', mode==='ringpos');
  document.getElementById('bAxial').classList.toggle('on', mode==='axial');
  document.getElementById('bCube').classList.toggle('on', mode==='cube');
  render();
}

function toggle(key) {
  if (key === 'tri') {
    showTri = !showTri;
    document.getElementById('bTri').classList.toggle('on', showTri);
  } else {
    showRingColor = !showRingColor;
    document.getElementById('bRingC').classList.toggle('on-origin', showRingColor);
  }
  render();
}

// ─── Interaction ───
let dragging = false, lx, ly;

area.addEventListener('mousedown', e => { dragging = true; lx = e.clientX; ly = e.clientY; });
window.addEventListener('mouseup', () => { dragging = false; });
window.addEventListener('mousemove', e => {
  if (dragging) {
    panX += e.clientX - lx; panY += e.clientY - ly;
    lx = e.clientX; ly = e.clientY;
    render(); return;
  }
  const rect = cv.getBoundingClientRect();
  const W = area.clientWidth, H = area.clientHeight;
  const mx = (e.clientX - rect.left - W/2 - panX) / zoom;
  const my = (e.clientY - rect.top - H/2 - panY) / zoom;

  let best = null, bestD = Infinity;
  for (const c of allCells) {
    if (c.ring > maxRing) continue;
    const [px, py] = toPixel(c.q, c.r);
    const d = Math.hypot(px - mx, py - my);
    if (d < HEX * 0.9 && d < bestD) { best = c; bestD = d; }
  }
  if (best !== hovered) { hovered = best; updateInfo(); render(); }
});

area.addEventListener('wheel', e => {
  e.preventDefault();
  zoom *= e.deltaY > 0 ? 0.9 : 1.1;
  zoom = Math.max(0.25, Math.min(6, zoom));
  document.getElementById('zl').textContent = `Zoom ${(zoom*100).toFixed(0)}%`;
  render();
}, {passive: false});

function updateInfo() {
  const el = document.getElementById('info');
  if (!hovered) { el.innerHTML = '<span class="il">Hover a cell to inspect</span>'; return; }
  const c = hovered, s = -c.q - c.r;
  const tri = triSet.has(c.num);
  el.innerHTML =
    `<div><span class="il">Spiral: </span><span class="iv">${c.num}</span>${tri ? ' <span class="it">▲ triangular</span>':''}</div>` +
    `<div><span class="il">Ring: </span><span class="iv">${c.ring}</span> <span class="il">Pos: </span><span class="iv">${c.pos}</span></div>` +
    `<div><span class="il">Axial: </span><span class="iv">(${c.q}, ${c.r})</span></div>` +
    `<div><span class="il">Cube: </span><span class="iv">(${c.q}, ${c.r}, ${s})</span></div>`;
}

// ─── Init ───
window.addEventListener('resize', render);
render();
</script>
</body>
</html>
